!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,i){t.exports=i.p+"img/player-new.png"},function(t){t.exports={knight:{display_name:"Knight",default:{stats:{hp:5,atk:2,def:0,sp_atk:0,sp_def:0,spd:0}}}}},function(t,e,i){t.exports=i.p+"img/knight.png"},function(t){t.exports={murdoc:{display_name:"Murdoc",default:{speech:["You look lost.","What's that, you are lost?","Well, you're in The Desolate Cave.","Be careful. There are bandits running around here."]}}}},function(t,e,i){t.exports=i.p+"img/dungeon_sheet.png"},function(t){t.exports={height:18,infinite:!1,layers:[{data:[55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,0,0,0,0,0,0,55,55,55,55,0,0,0,0,0,0,0,0,0,0,0,0,55,55,55,55,0,0,0,0,0,0],height:18,id:19,name:"floor",opacity:1,type:"tilelayer",visible:!0,width:16,x:0,y:0},{data:[6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,0,0,238,238,238,238,0,0,0,0,0,0,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,238,238,238,238,0,0,0,0,238,238,56,54,0,0,238,238,0,238,238,238,0,0,0,0,238,238,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,78,79,79,79,79,79,10,0,0,9,79,79,79,79,79,80,26,26,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,26,26,26,26,26,54,0,0,56,26,26,26,26,26,26],height:18,id:20,name:"walls",opacity:1,type:"tilelayer",visible:!0,width:16,x:0,y:0},{draworder:"topdown",id:10,name:"player_start_0.1",objects:[{height:20,id:46,name:"",rotation:0,type:"",visible:!0,width:8,x:124,y:260}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:11,name:"player_start_0.0",objects:[{height:32,id:44,name:"",rotation:0,type:"",visible:!0,width:12,x:122,y:112}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:12,name:"config",objects:[],opacity:1,properties:[{name:"level",type:"string",value:"0.0"}],type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:9,name:"portal",objects:[{height:8,id:29,name:"",rotation:0,type:"",visible:!0,width:40,x:108,y:280}],opacity:1,properties:[{name:"portal_from",type:"string",value:"0.0"},{name:"portal_to",type:"string",value:"0.1"}],type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:5,name:"collision",objects:[{height:32,id:47,name:"",rotation:0,type:"",visible:!0,width:255.636363636364,x:.363636363636364,y:0},{height:224,id:49,name:"",rotation:0,type:"",visible:!0,width:14,x:242,y:32},{height:224,id:50,name:"",rotation:0,type:"",visible:!0,width:16,x:0,y:32},{height:14,id:51,name:"",rotation:0,type:"",visible:!0,width:93,x:151,y:242},{height:14,id:52,name:"",rotation:0,type:"",visible:!0,width:93,x:12,y:242},{height:46,id:54,name:"",rotation:0,type:"",visible:!0,width:16,x:148,y:242},{height:46,id:55,name:"",rotation:0,type:"",visible:!0,width:16,x:92,y:242}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:21,nextobjectid:56,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.2.3",tileheight:16,tilesets:[{firstgid:1,source:"C:/Users/Anthony/Desktop/maps/dungeon_tiles.tsx"}],tilewidth:16,type:"map",version:1.2,width:16}},function(t){t.exports={height:20,infinite:!1,layers:[{data:[55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55],height:20,id:12,name:"floor",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{data:[6,7,7,7,7,7,7,7,7,7,7,7,8,26,26,26,26,26,54,0,56,26,26,26,26,26,26,26,26,26,26,26,30,31,31,31,31,31,31,31,31,31,31,31,32,26,26,26,6,7,58,0,57,7,7,7,7,7,7,7,7,7,7,8,54,0,213,0,0,0,0,213,0,0,0,0,56,26,26,26,30,31,82,0,81,31,31,31,31,31,31,31,31,31,31,32,54,213,213,213,213,19,20,213,0,0,0,0,56,26,26,26,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,213,213,213,213,43,44,213,0,0,0,0,56,26,26,26,54,0,0,0,0,0,0,0,0,9,79,79,79,10,0,56,54,213,213,213,213,67,68,213,0,0,0,0,56,26,26,26,54,0,0,0,0,0,0,0,0,56,26,26,26,54,0,56,54,213,213,213,213,0,0,213,0,0,0,0,56,26,26,26,54,0,0,0,0,0,0,0,0,56,26,26,26,54,0,56,54,0,213,213,213,19,20,0,0,0,0,0,56,26,26,26,54,0,0,0,0,0,0,0,0,56,26,26,26,54,0,56,54,0,213,213,213,43,44,0,0,0,0,0,56,26,26,26,78,79,79,79,79,79,79,79,79,80,26,26,26,54,0,56,54,0,0,0,0,67,68,0,0,0,0,0,57,7,7,7,7,7,7,7,7,7,7,7,7,106,7,7,7,58,0,56,54,0,0,0,0,0,0,0,0,0,0,0,81,31,31,31,31,31,31,31,31,31,31,31,31,129,31,31,31,82,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,78,79,79,79,10,0,0,9,79,79,79,79,79,79,79,10,0,9,79,79,79,79,79,79,79,79,79,79,79,79,79,80,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,54,0,56,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,54,0,57,7,7,7,7,7,7,7,7,7,7,7,7,7,8,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,54,0,81,31,31,31,31,31,31,31,31,31,31,31,31,31,32,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,78,79,79,79,79,79,79,79,79,79,79,10,0,0,189,0,56,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,54,0,0,0,0,56,26,26,26,26,54,0,0,56,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,78,79,79,79,79,80],height:20,id:13,name:"walls",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:6,name:"player_start_0.0",objects:[{height:24,id:14,name:"",rotation:0,type:"",visible:!0,width:8,x:309,y:8}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:14,name:"npcs",objects:[{height:16,id:37,name:"",properties:[{name:"name",type:"string",value:"murdoc"}],rotation:0,type:"",visible:!0,width:16,x:464,y:272}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:15,name:"enemies",objects:[{height:20,id:38,name:"",properties:[{name:"type",type:"string",value:"knight"}],rotation:0,type:"",visible:!0,width:10,x:288,y:64}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:8,name:"player_start_0.2",objects:[{height:24,id:16,name:"",rotation:0,type:"",visible:!0,width:8,x:92,y:288}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:7,name:"config",objects:[],opacity:1,properties:[{name:"level",type:"string",value:"0.1"}],type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:3,name:"collision",objects:[{height:126,id:19,name:"",rotation:0,type:"",visible:!0,width:80,x:0,y:194},{height:126,id:22,name:"",rotation:0,type:"",visible:!0,width:144,x:112,y:194},{height:62,id:23,name:"",rotation:0,type:"",visible:!0,width:240,x:272,y:194},{height:46,id:24,name:"",rotation:0,type:"",visible:!0,width:176,x:256,y:274},{height:64,id:25,name:"",rotation:0,type:"",visible:!0,width:13,x:499,y:256},{height:14,id:26,name:"",rotation:0,type:"",visible:!0,width:67,x:432,y:306},{height:138,id:27,name:"",rotation:0,type:"",visible:!0,width:73,x:196,y:0},{height:46,id:28,name:"",rotation:0,type:"",visible:!0,width:281,x:196,y:130},{height:66,id:29,name:"",rotation:0,type:"",visible:!0,width:73,x:404,y:64},{height:48,id:30,name:"",rotation:0,type:"",visible:!0,width:188,x:324,y:0},{height:146,id:31,name:"",rotation:0,type:"",visible:!0,width:11,x:501,y:48},{height:32,id:32,name:"",rotation:0,type:"",visible:!0,width:196,x:0,y:0},{height:162,id:33,name:"",rotation:0,type:"",visible:!0,width:13,x:0,y:32},{height:40,id:34,name:"",rotation:0,type:"",visible:!0,width:26,x:83,y:51},{height:40,id:35,name:"",rotation:0,type:"",visible:!0,width:26,x:83,y:115},{height:48,id:36,name:"",rotation:0,type:"",visible:!0,width:33,x:269,y:0}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:5,name:"portal",objects:[{height:8,id:11,name:"",properties:[{name:"portal_to",type:"string",value:"1.0"}],rotation:0,type:"",visible:!0,width:22,x:302,y:0}],opacity:1,properties:[{name:"portal_from",type:"string",value:"0.1"},{name:"portal_to",type:"string",value:"0.0"}],type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:9,name:"portal",objects:[{height:8,id:18,name:"",properties:[{name:"portal_to",type:"string",value:"1.0"}],rotation:0,type:"",visible:!0,width:32,x:80,y:312}],opacity:1,properties:[{name:"portal_from",type:"string",value:"0.1"},{name:"portal_to",type:"string",value:"0.2"}],type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:16,nextobjectid:39,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.2.3",tileheight:16,tilesets:[{firstgid:1,source:"C:/Users/Anthony/Desktop/maps/dungeon_tiles.tsx"}],tilewidth:16,type:"map",version:1.2,width:32}},function(t){t.exports={height:16,infinite:!1,layers:[{data:[55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55],height:16,id:3,name:"floor",opacity:1,type:"tilelayer",visible:!0,width:24,x:0,y:0},{data:[6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,0,9,79,79,79,79,79,10,0,0,9,79,79,79,79,79,79,10,0,0,56,0,0,0,0,56,6,7,7,7,7,58,0,0,57,7,7,7,7,7,8,54,0,0,56,0,0,0,0,56,30,31,31,31,31,82,0,0,81,31,31,31,31,31,32,54,0,0,56,54,0,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,56,54,0,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,56,54,0,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,56,54,0,0,0,56,78,79,79,79,79,79,79,79,79,79,79,79,79,79,80,54,0,0,56,54,0,0,0,57,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,58,0,0,56,54,0,0,0,81,31,169,31,169,31,169,31,169,31,169,31,169,31,169,31,82,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,78,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80],height:16,id:4,name:"walls",opacity:1,type:"tilelayer",visible:!0,width:24,x:0,y:0},{draworder:"topdown",id:5,name:"collision",objects:[{height:32,id:1,name:"",rotation:0,type:"",visible:!0,width:384,x:0,y:0},{height:96,id:2,name:"",rotation:0,type:"",visible:!0,width:0,x:384,y:16},{height:224,id:4,name:"",rotation:0,type:"",visible:!0,width:16,x:368,y:32},{height:144,id:5,name:"",rotation:0,type:"",visible:!0,width:16,x:0,y:112},{height:48,id:6,name:"",rotation:0,type:"",visible:!0,width:16,x:0,y:32},{height:48,id:9,name:"",rotation:0,type:"",visible:!0,width:32,x:64,y:112},{height:48,id:10,name:"",rotation:0,type:"",visible:!0,width:32,x:304,y:112},{height:37,id:12,name:"",rotation:0,type:"",visible:!0,width:128,x:208,y:75.25},{height:37,id:13,name:"",rotation:0,type:"",visible:!0,width:112,x:64,y:75},{height:48,id:14,name:"",rotation:0,type:"",visible:!0,width:272,x:64,y:160},{height:16,id:16,name:"",rotation:0,type:"",visible:!0,width:352,x:16,y:240}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:6,name:"portal",objects:[{height:32,id:18,name:"",properties:[{name:"portal_from",type:"string",value:"0.2"},{name:"portal_to",type:"string",value:"0.1"}],rotation:0,type:"",visible:!0,width:8,x:0,y:80}],opacity:1,properties:[{name:"portal_from",type:"string",value:"0.2"},{name:"portal_to",type:"string",value:"0.1"}],type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",id:7,name:"player_start_0.1",objects:[{height:32,id:19,name:"",rotation:0,type:"",visible:!0,width:8,x:8,y:80}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:8,nextobjectid:20,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.2.3",tileheight:16,tilesets:[{firstgid:1,source:"C:/Users/Anthony/Desktop/maps/dungeon_tiles.tsx"}],tilewidth:16,type:"map",version:1.2,width:24}},function(t,e,i){i(10),t.exports=i(9)},function(t,e,i){},function(t,e,i){"use strict";i.r(e);const s=t=>t.charAt(0).toLowerCase()+t.slice(1);class r{constructor(t){this.menu=t,this.selected=[],this.selected.push(this.menu[0]),W.register(this)}open(){this.active=!0,W.emit(`menu.${s(this.constructor.name)}.open`)}close(){this.active=!1,W.emit(`menu.${s(this.constructor.name)}.close`)}lock(){return this.locked=!0,!0}unlock(){return this.locked=!1,!0}destroy(){this.active&&this.close(),W.unregister(this)}select(){let t=this.currentOption;t.hasOwnProperty("menu")&&t.menu.length?this.selected.push(t.menu[0]):t.hasOwnProperty("action")&&t.action(this)}back(){if(this.selected.length>1)return this.selected.pop();this.close()}previous(){let t=this.currentMenu,e=this.currentOption,i=t.reduce((t,i,s)=>i===e?s:t,0);this.selected[this.selected.length-1]=0===i?t[t.length-1]:t[i-1]}next(){let t=this.currentMenu,e=this.currentOption,i=t.reduce((t,i,s)=>i===e?s:t,0);i===t.length-1?this.selected[this.selected.length-1]=t[0]:this.selected[this.selected.length-1]=t[i+1]}hasSubMenu(){let t=this.currentOption;return t.menu&&t.menu.length}draw(t,e,i){}register(){return{keyup:t=>{if(this.active){if("Escape"===t.key)return this.close();switch(t.key){case"ArrowRight":case"Enter":this.select();break;case"ArrowLeft":case"Backspace":this.back();break;case"ArrowUp":this.previous();break;case"ArrowDown":this.next()}}}}}get currentOption(){return this.selected[this.selected.length-1]}get currentMenu(){return this.selected.length>1?this.selected[this.selected.length-2].menu:this.menu}}class a{constructor(t,e){this.x=t,this.y=e}copy(){return new a(this.x,this.y)}plus(t){return new a(this.x+t.x,this.y+t.y)}times(t){return"number"==typeof t?new a(this.x*t,this.y*t):new a(this.x*t.x,this.y*t.y)}toArray(){return[this.x,this.y]}}var n=a;class h extends r{constructor(...t){super(t)}draw(t,e,i){t.save(),t.font="12px Arial";let s=new n(72,24),r=new n(8,0);t.translate(e.x-(s.x+r.x)*this.menu.length,e.y+s.y),this.menu.forEach(e=>{let i=e===this.selected[0];t.translate(s.x+r.x,0),t.font="12px Arial",t.fillStyle="#fff",e===this.selected[0]&&(t.fillStyle="#ddd",t.strokeRect(0,0,s.x,s.y)),e===this.currentOption&&(t.font="bold 12px Arial"),t.fillRect(0,0,s.x,s.y),t.fillStyle="#000",t.fillText(e.type,4,16),i&&e.menu&&e.menu.length&&e.menu.forEach((e,i)=>{t.save(),e===this.currentOption?t.font="bold 12px Arial":t.font="12px Arial";let s=e.name?e.name:e;t.translate(0,18*(i+1)+6),t.fillText(s,0,16),t.restore()})}),t.restore()}register(){return{keyup:t=>{let e=this.currentMenu,i=this.currentOption;switch(t.key){case"ArrowDown":this.hasSubMenu()?this.select():this.selected.length>1&&this.next();break;case"ArrowUp":i===e[0]?this.back():this.selected.length>1&&this.previous();break;case"ArrowLeft":1===this.selected.length&&this.previous();break;case"ArrowRight":1===this.selected.length&&this.next();break;case"Enter":"function"==typeof i.use&&i.use()}}}}}class o{constructor(t,e){this.active=!0,this.player=t,this.player.savePos(),this.player.pos.x=64,this.player.pos.y=128,this.player.direction=4,this.player.lock(),this.enemy=e,this.enemy.savePos(),this.enemy.pos.x=320,this.enemy.pos.y=0,this.enemy.direction=2,this.enemy.lock(),this.playersTurn=this.player.stats.spd>this.enemy.stats.spd,this.battleMenu=this.getBattleMenu(),W.register(this)}cycle(){this.playersTurn=!this.playersTurn,this.playersTurn||W.emit("battleAction",this)}getBattleMenu(){return new h({type:"Items",menu:[]},{type:"Attack",menu:this.player.weapon?[this.player.weapon]:[]},{type:"Spells",menu:this.player.spells},{type:"Other",menu:["Defend","Run Away"]})}update(t){}draw(t,e,i){let s=i.x,r=i.y;if(t.save(),t.fillStyle="#ccc",t.fillRect(0,0,s,r),t.fillStyle="#FFF",t.textAlign="center",t.restore(),t.save(),t.translate(e.x,e.y),this.player.draw(t,e,i),this.enemy.draw(t,e,i),t.restore(),this.drawUiBar(t),this.drawEnemyUiBar(t,s,r),this.playersTurn){let s=e.plus(new n(this.player.pos.x,this.player.pos.y+this.player.size.y));this.battleMenu.draw(t,s,i)}}drawUiBar(t){t.save(),t.fillStyle="#000",t.fillRect(0,0,512,48),t.fillStyle="#FFF",t.font="20px Arial",t.fillText("HP : "+this.player.stats.hp,16,32),t.restore()}drawEnemyUiBar(t,e,i){t.save(),t.translate(e-512,0),t.fillStyle="#000",t.fillRect(0,0,512,48),t.fillStyle="#FFF",t.font="20px Arial",t.fillText("HP : "+this.enemy.stats.hp,16,32),t.restore()}register(){return{battleAction:t=>{this.playersTurn?this.player.attack(this.enemy,t.attack):this.enemy.attack(this.player),this.player.stats.hp<=0||(this.enemy.stats.hp<=0?(this.player.stats.gainExp(this.enemy.stats.givesExp),this.player.restorePos(),this.enemy.restorePos(),this.stop()):this.cycle())}}}stop(){this.enemy.defeated=!0,this.active=!1,W.emit("battle.end"),W.unregister(this),this.battleMenu.destroy()}}class l{constructor(t){for(let e in t)this[e]=t[e];this.type="equipable"}use(){W.emit("battleAction",this)}}class p extends r{constructor(){super([{type:"item",description:"Items",menu:[]},{type:"equipable",description:"Equipment",menu:[]},{type:"special",description:"Special",menu:[]}]),this.active=!1,this.equipped={weapon:null,armor:null,spell:null},this.store(new l({name:"Basic Sword",description:"A basic bish sword.",damage:3})),this.store(new l({name:"Mace",description:"An effing mace. Watch out!",damage:10})),this.store(new l({name:"Pole Arm",description:"Swift and strong.",damage:5}))}store(t){this.menu.filter(e=>e.type===t.type)[0].menu.push(t)}draw(t,e,i){if(!this.active)return;t.save(),t.translate(-e.x,-e.y),t.fillStyle="rgba(200, 200, 200, .96)",t.fillRect(0,0,i.x,i.y),t.fillStyle="#75A",t.textAlign="left";let s=this.currentOption;this.selected.reduce((e,i,r)=>{let a=r>0?this.selected[r-1].menu:this.menu;return e+a.reduce((a,h,o)=>{let l=new n(48+200*r,48+48*(o+e+1));return t.save(),t.font="24px Arial",h===s&&(t.shadowColor="#75A",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=4,t.font="bold 24px Arial"),t.fillText(h.description,l.x,l.y),t.restore(),a+(h===i?o:0)},0)},0),t.restore()}register(){return[super.register(),{keyup:t=>{"i"!==t.key||this.locked||(this.active?this.close():this.open())}}]}}var d={debug:!1,scale:3};var c=class{constructor(t,e){this.pos=t.times(d.scale),this._size=e,this.direction=0,this.inDialogue=!1,this.locked=!1,this.lastPos=t.copy(),this.savedPos=t.copy(),this.savedDirection=this.direction}update(t){}draw(t,e,i){d.debug&&this.debugDraw(t),this.lastPos.x=this.pos.x,this.lastPos.y=this.pos.y}get size(){return this._size}debugDraw(t){t.fillStyle="#F99",t.fillRect(this.pos.x,this.pos.y,this._size.x,this._size.y)}lock(){return this.locked=!0,!0}unlock(){return!this.inDialogue&&(this.locked=!1,!0)}backstep(t){let e=this.collisionPoint(!0);t?e.x<t.pos.x||e.x>t.pos.x+t.size.x?this.pos.x=this.lastPos.x:this.pos.y=this.lastPos.y:(this.pos.x=this.lastPos.x,this.pos.y=this.lastPos.y)}collidesWith(t){let e=this.collisionPoint();return!!(e.x>t.pos.x&&e.x<t.pos.x+t.size.x&&e.y>t.pos.y&&e.y<t.pos.y+t.size.y)&&{pos:t.pos.copy(),size:t.size.copy()}}collisionPoint(t=!1){return new n((t?this.lastPos.x:this.pos.x)+.5*this._size.x,(t?this.lastPos.y:this.pos.y)+.8*this._size.y)}savePos(){this.savedPos=this.pos.copy(),this.savedDirection=this.direction}restorePos(t=!0){this.pos=this.savedPos.copy(),this.direction=this.savedDirection,t&&this.unlock()}attack(t,e){!e&&this.weapon&&(e=this.weapon);let i=e&&e.damage?e.damage:0,s=this.stats.atk+i;t.endure(s)}endure(t){this.stats.endure(t)}};class y{constructor(t,e=1,i=0,s=9,r=new n(9,4),a=30){this.ready=!1,this.img=new Image,this.img.src=t,this.scale=e,this.frame=i,this.startFrame=i,this.frameCount=s,this.gridRatio=r,this.fps=a,this.nextAnimationTimestamp=(new Date).getTime(),this.img.onload=()=>{this.spriteSize=new n(this.img.width/this.gridRatio.x,this.img.height/this.gridRatio.y),this.ready=!0}}draw(t){if(!this.ready)return;let e=(new Date).getTime();e>=this.nextAnimationTimestamp&&(this.frame++,this.nextAnimationTimestamp=e+1e3/this.fps),this.frame>this.startFrame+this.frameCount&&(this.frame=this.startFrame);let i=this.frame%this.gridRatio.x*this.spriteSize.x,s=Math.floor(this.frame/this.gridRatio.x)*this.spriteSize.y;t.drawImage(this.img,i,s,this.spriteSize.x,this.spriteSize.y,0,0,this.spriteSize.x*this.scale,this.spriteSize.y*this.scale)}}class u{constructor(t){this.stats=t,this.lvl=1,this.exp=0,this.dmg=0}get hp(){return Math.max(0,this.stats.hp-this.dmg)}get atk(){return this.stats.atk}get def(){return this.stats.def}get sp_atk(){return this.stats.sp_atk}get sp_def(){return this.stats.sp_def}get spd(){return this.stats.spd}get givesExp(){return this.stats.hp+this.stats.atk+this.stats.def+this.stats.sp_atk+this.stats.sp_def+this.stats.spd}endure(t){this.dmg+=t}gainExp(t){this.exp+=t}}var m=i(1),w=i(2);let g={knight:i.n(w).a};class x extends c{constructor(t){super(new n(t.x,t.y),new n(t.width,t.height));let e=t.properties.filter(t=>"type"===t.name)[0].value,i=m[e];if(!i)throw new Error("Enemy data for "+name+" is not defined in enemies.json");this.type=e,this.data=i,this.dialogue=null,this.stats=new u(i.default.stats),this.defeated=!1;let s=g[this.type];this.sprites=[new y(s,2,0,0,new n(1,4),8),new y(s,2,3,0,new n(1,4),8),new y(s,2,2,0,new n(1,4),8),new y(s,2,0,0,new n(1,4),8),new y(s,2,1,0,new n(1,4),8)],this.direction=4}get dialogueName(){return this.data.display_name}fight(t){this.defeated||W.emit("battle.start",{player:t,enemy:this})}update(t){}draw(t,e,i){this.defeated||(super.draw(t,e,i),t.save(),t.translate(this.pos.x,this.pos.y),this.sprites[this.direction].draw(t),t.restore())}}class f{constructor(t,e,i){this.texts=t,this.speaker=e,this.actors=i,this.currentText="",this.index=0,this.waiting=!1,this.done=!1,this.frameLength=1e3/24,this.timeStore=0,this.actors.push(this.speaker),W.register(this),this.start()}update(t){if(!this.waiting){for(this.timeStore+=t;this.timeStore>this.frameLength;)this.currentText=this.texts[this.index].substring(0,this.currentText.length+1),this.timeStore-=this.frameLength;return this.currentText===this.texts[this.index]?this.waiting=!0:void 0}}draw(t,e,i){t.save(),t.translate(32-e.x,48-e.y),t.font="30px Arial",t.fillStyle="#FFF",t.fillText(this.speaker.dialogueName+": "+this.currentText,0,0),t.restore()}start(){this.actors.forEach(t=>{t.lock(),t.inDialogue=!0})}stop(){this.actors.forEach(t=>{t.unlock(),t.inDialogue=!1}),W.unregister(this)}register(){return{keyup:(t,e)=>{"Enter"===t.key&&this.next(t),this.done&&this.stop()}}}next(t){this.waiting&&!this.done&&(this.index+1<this.texts.length?(this.index++,this.timeStore=0,this.currentText="",this.waiting=!1):this.done=!0)}}var v=i(3);class b extends c{constructor(t,e){super(new n(t.x,t.y),new n(t.width,t.height));let i=t.properties.filter(t=>"name"===t.name)[0].value,s=v[i];if(!s)throw new Error("NPC data for "+i+" is not defined in npcs.json");this.name=i,this.data=s,this.dialogue=null,this.playerRef=e,W.register(this)}get dialogueName(){return this.data.display_name}speak(){!this.dialogue&&this.collidesWith(this.playerRef)&&(this.dialogue=new f(this.data.default.speech,this,[this.playerRef]))}update(t){this.dialogue&&this.dialogue.done?this.dialogue=null:this.dialogue&&this.dialogue.update(t)}draw(t,e,i){this.dialogue&&this.dialogue.draw(t,e,i)}register(){return{keyup:t=>{" "!==t.key&&"Enter"!==t.key||this.speak()}}}}class k{constructor(t,e){this.pos=t||new n(0,0),this.size=e||new n(0,0)}update(t){}draw(t){d.debug&&(t.strokeStyle="#F00",t.strokeRect(this.pos.x,this.pos.y,this.size.x,this.size.y))}}class S extends k{constructor(t,e){super(t,e)}draw(t){super.draw(t)}}class _ extends k{constructor(t,e,i){super(t,e),i&&i.properties&&i.properties.forEach(t=>{this[t.name]=t.value})}draw(t){super.draw(t)}}class A{constructor(t,e,i){this.data=t,this.player=i,this.pos=new n(0,0),this.scale=d.scale,this.config={},this.renderable=new y(e,this.scale,0,240,new n(24,10),0),this.playerClips=[],this.portals=[],this.npcs=[],this.enemies=[],this.playerStarts={},this.data.layers.forEach(t=>{"objectgroup"===t.type&&t.objects.forEach(e=>{let s=new n(e.x*this.scale,e.y*this.scale),r=new n(e.width*this.scale,e.height*this.scale),a=t.name.match(/^player_start_(\d+\.\d+)$/);"collision"===t.name?this.playerClips.push(new S(s,r)):"portal"===t.name?this.portals.push(new _(s,r,t)):"npcs"===t.name?this.npcs.push(new b(e,i)):"enemies"===t.name?this.enemies.push(new x(e)):"config"===t.name?this.config=e.properties:a&&(this.playerStarts[a[1]]=e)})})}update(t){let e=[];return this.playerClips.forEach(t=>{let e=this.player.collidesWith(t);e&&this.player.backstep(e)}),this.portals.forEach(t=>{this.player.collidesWith(t)&&e.push({type:"enter_portal",obj:t})}),e}draw(t,e=!1){this.renderable.ready&&this.data.layers.forEach(i=>{if("tilelayer"!==i.type)return;if(e&&"above_player"!==i.name)return;if(!e&&"above_player"===i.name)return;let s=this.renderable;i.data.forEach((e,r)=>{s.frame=e-1;let a=new n(r%i.width,Math.floor(r/i.width));t.save(),t.translate(...a.times(s.spriteSize).times(s.scale).plus(this.pos).toArray()),s.draw(t),t.restore()})})}destruct(){this.npcs.forEach(t=>W.unregister(t))}}var j=i(4),P=i.n(j);var E=class{constructor(t,e){this.player=e,this.inanimates=[],this.actors=[],this.dialogues=[],this.reload(t)}reload(t,e){this.map&&this.map.destruct(),this.map=new A(t,P.a,this.player);let i=e?this.map.playerStarts[e.portal_from]:this.map.playerStarts["0.0"];this.player.pos.x=i.x*d.scale,this.player.pos.y=i.y*d.scale}update(t){return this.entities.forEach(e=>{e.update(t),e instanceof x&&e.collidesWith(this.player)&&e.fight(this.player)}),this.dialogues.forEach((t,e)=>{t.done&&this.dialogues.splice(e,1)}),this.map.update(t)}get entities(){return[this.player,...this.inanimates,...this.actors,...this.dialogues,...this.map.npcs,...this.map.enemies]}},M=i(0),z=i.n(M);var R=class extends c{constructor(t,e){super(t,e),this.speed=new n(0,0),this.maxSpeed=e.x/10,this.sprites=[new y(z.a,2,0,0,new n(1,4),8),new y(z.a,2,3,0,new n(1,4),8),new y(z.a,2,2,0,new n(1,4),8),new y(z.a,2,0,0,new n(1,4),8),new y(z.a,2,1,0,new n(1,4),8)],this.stats=new u({hp:10,atk:2,def:0,sp_atk:0,sp_def:0,spd:1}),this.weapon=null,this.spells=[],W.register(this),this.init()}get name(){return"player"}get dialogueName(){return"Me"}update(t){this.locked||(this.pos.x+=this.speed.x,this.pos.y+=this.speed.y,super.update(t))}draw(t,e,i){super.draw(t,e,i),t.save(),t.translate(this.pos.x,this.pos.y),this.sprites[this.direction].draw(t),t.restore()}move(t){switch(t){case"ArrowLeft":this.speed.x=-this.maxSpeed;break;case"ArrowDown":this.speed.y=this.maxSpeed;break;case"ArrowRight":this.speed.x=this.maxSpeed;break;case"ArrowUp":this.speed.y=-this.maxSpeed}this.changeDirection()}stop(t){"ArrowLeft"===t&&this.speed.x<0&&(this.speed.x=0),"ArrowRight"===t&&this.speed.x>0&&(this.speed.x=0),"ArrowUp"===t&&this.speed.y<0&&(this.speed.y=0),"ArrowDown"===t&&this.speed.y>0&&(this.speed.y=0),this.changeDirection()}changeDirection(){this.locked||(this.speed.x>0?this.direction=4:this.speed.x<0?this.direction=2:this.speed.y>0?this.direction=3:this.speed.y<0&&(this.direction=1))}register(){return{keydown:t=>{t.key.match(/Arrow/)&&this.move(t.key)},keyup:t=>{t.key.match(/Arrow/)&&this.stop(t.key)}}}init(){this.weapon=new l({name:"Basic Sword",description:"A basic bish sword.",damage:1})}};class T extends r{constructor(){super([{type:"start",description:"Press Enter to Start!",action:t=>{t.close()}},{type:"load",description:"Load Saved State (doesn't work yet)",action:t=>{}}])}draw(t,e,i){if(!this.active)return!1;t.save(),t.translate(-e.x,-e.y),t.fillStyle="rgba(0, 0, 0, .85)",t.fillRect(0,0,i.x,i.y),t.fillStyle="#FFF",t.textAlign="center",this.menu.forEach((e,s)=>{let r=this.menu[s],a=r===this.currentOption;a?(t.shadowColor="#FFF",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=4,t.font="bold 42px Arial"):t.font="42px Arial",t.fillText(a?"▶ "+r.description:r.description,i.x/2,i.y/(this.menu.length-s)*.5)}),t.restore()}}var D,F=[[i(5),i(6),i(7)]];!function(t){t[t.StartMenu=0]="StartMenu",t[t.Play=1]="Play",t[t.Pause=2]="Pause",t[t.Inventory=3]="Inventory",t[t.Battle=4]="Battle"}(D||(D={}));var O,B=class{constructor(){this.battle=null,this.state=D.Play,this.menu=new T,this.inventory=new p,this.player=new R(new n(75,75),new n(36,64)),W.register(this),this.menu.open()}loadLevel(t){let e=t.obj.portal_to.match(/^(\d+)\.(\d+)$/),i=F[parseInt(e[1])][parseInt(e[2])],s=t.obj;this.level.reload(i,s)}start(){this.level=new E(F[0][0],this.player)}update(t){this.battle&&this.battle.update(t),this.state===D.Play&&this.level.update(t).forEach(t=>{(t.type="enter_portal")&&this.loadLevel(t)})}draw(t,e,i){if(this.level.map.draw(t),this.level.entities.forEach(s=>{s.draw(t,e,i)}),this.level.map.draw(t,!0),this.hasActiveBattle()){let e=new n(i.x/2-128-64,i.y/2-64-64);this.battle.draw(t,e,i)}this.menu.draw(t,e,i),this.inventory.draw(t,e,i)}lock(t){this.state===D.Play&&(this.state=t,this.player.lock(),t!==D.Inventory&&this.inventory.lock())}unlock(t){this.state===t&&(this.player.unlock(),this.inventory.unlock(),this.state=D.Play)}register(){return{"battle.start":t=>{this.battle=this.battle||new o(t.detail.player,t.detail.enemy),this.lock(D.Battle)},"battle.end":t=>{this.battle=null,this.unlock(D.Battle)},"menu.inventory.open":t=>this.lock(D.Inventory),"menu.inventory.close":t=>this.unlock(D.Inventory),"menu.startMenu.open":t=>this.lock(D.StartMenu),"menu.startMenu.close":t=>this.unlock(D.StartMenu)}}get renderPoint(){return new n(this.player.pos.x,this.player.pos.y)}hasActiveBattle(){return null!==this.battle&&this.battle.active}};!function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic"}(O||(O={}));var C=class{constructor(t,e,i){this.aspectRatio=t,this.width=t.x,this.height=t.y,this.game=i,this.renderMode=O.Dynamic,this.ctx=e.getContext("2d"),this.buffer=document.createElement("canvas").getContext("2d"),this.resizetoWindow(),W.register(this)}draw(){let t=this.offset;this.buffer.clearRect(0,0,this.width,this.height),this.buffer.save(),this.buffer.translate(t.x,t.y),this.game.draw(this.buffer,t,this.resolution),this.buffer.restore(),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.buffer.canvas,0,0,this.buffer.canvas.width,this.buffer.canvas.height,0,0,this.ctx.canvas.width,this.ctx.canvas.height)}resizetoWindow(){if(window.innerWidth>=this.aspectRatio.x)return this.resizeCanvases();let t=this.height/this.width,e=Math.floor(window.innerWidth),i=Math.floor(window.innerWidth*t);e%2==1&&e--,i%2==1&&i--,this.resizeCanvases(e,i)}resizeCanvases(t=this.aspectRatio.x,e=this.aspectRatio.y){this.ctx.canvas.width=t,this.ctx.canvas.height=e,this.ctx.imageSmoothingEnabled=!1,this.buffer.canvas.width=t,this.buffer.canvas.height=e,this.buffer.imageSmoothingEnabled=!1,this.width=t,this.height=e}register(){return{resize:t=>this.resizetoWindow(),"battle.start":t=>this.renderMode=O.Static,"battle.end":t=>this.renderMode=O.Dynamic}}get offset(){if(this.renderMode===O.Static)return new n(0,0);let t=this.game.renderPoint;return new n(this.width/2-t.x,this.height/2-t.y)}get resolution(){return new n(this.width,this.height)}};i.d(e,"bus",function(){return W});let W=new class{constructor(){this.events={}}register(t){let e=t.register();Array.isArray(e)?e.forEach(e=>this.install(t,e)):this.install(t,e)}unregister(t){for(let e in this.events)this.events[e]=this.events[e].filter(e=>e.target!==t)}emit(t,e){let i=new CustomEvent(t,{detail:e});window.dispatchEvent(i)}install(t,e){for(let i in e)this.events.hasOwnProperty(i)||(this.events[i]=[],window.addEventListener(i,t=>{this.events[i].forEach(e=>{e.handle(t,this)})})),this.events[i].push({target:t,handle:e[i]})}};const I=new n(1280,720);let L=document.getElementById("game"),U=new B,q=new C(I,L,U),N=0;U.start(),requestAnimationFrame(function t(e){let i=e-N;N=e,U.update(i),q.draw(),requestAnimationFrame(t)})}]);